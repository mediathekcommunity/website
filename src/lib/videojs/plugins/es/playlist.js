/**
 * Copyright (c) 2024 The Nuevodevel Team. All rights reserved.
 * Playlist plugin for video.js
 * Version 1.3.0
 */
/* eslint-disable */import videojs from"video.js";var first_play,first_item=!0,validSeconds=function(e){return"number"===typeof e&&!isNaN(e)&&e>=0&&e<1/0},reset=function(e){var t=e.playlist.autoadvance_;t.timeout&&e.clearTimeout(t.timeout);t.trigger&&e.off("ended",t.trigger);t.timeout=null;t.trigger=null},setup=function t(r,n){reset(r);if(validSeconds(n)){r.playlist.autoadvance_.delay=n;r.playlist.autoadvance_.trigger=function(){var e=function(){return t(r,n)};r.one("play",e);r.playlist.autoadvance_.timeout=r.setTimeout(()=>{reset(r);r.off("play",e);r.playlist.next()},1e3*n)};r.one("ended",r.playlist.autoadvance_.trigger)}else r.playlist.autoadvance_.delay=null},playItem=function(t,r){var n=!t.paused()||t.ended();r.playlistItemId_&&(t.playlist.currentPlaylistItemId_=r.playlistItemId_);if("function"===typeof t.beforePlaylistChange){var e=t.beforePlaylistChange(r.playlistItemId_,r);e&&(r=e)}t.one("playing",function(){first_play=!0});t.changeSource(r);first_play&&setTimeout(function(){t.trigger("playlist_change",{id:r.playlistItemId_})},500);if(t.uniquePlaylist&&localStorage){e=String("vjs_playlist-"+t.uniquePlaylist);localStorage[e]=r.playlistItemId_}!0===first_play&&setTimeout(()=>{t.play()},200);t.ready(function(){t.trigger("playlistitem",r.originalValue||r);t.trigger("playlist_newitem",{id:r.playlistItemId_});first_item=first_item&&!1;if(n){var e=t.play();"undefined"!==typeof e&&"function"===typeof e.then&&e.then(null,function(e){})}setup(t,t.playlist.autoadvance_.delay)});return t},isItemObject=function(e){return!!e&&"object"===typeof e},transformPrimitiveItems=function(e){var t,r=[];e.forEach(function(e){isItemObject(e)?t=e:(t=Object(e)).originalValue=e;r.push(t)});return r},generatePlaylistItemId=function(e){var t=1;e.forEach(function(e){e.playlistItemId_=t++})},indexInPlaylistItemIds=function(e,t){for(var r=0;r<e.length;r++)if(e[r].playlistItemId_===t)return r;return-1},sourceEquals=function(e,t){var r=e,n=t;"object"===typeof e&&(r=e.src);"object"===typeof t&&(n=t.src);/^\/\//.test(r)&&(n=n.slice(n.indexOf("//")));return(r=/^\/\//.test(n)?r.slice(r.indexOf("//")):r)===n},indexInSources=function(e,t){for(var r=0;r<e.length;r++){var n=e[r].sources;if(Array.isArray(n))for(var i=0;i<n.length;i++){var a=n[i];if(a&&sourceEquals(a,t))return r}}return-1};function factory(n,e,t){void 0===t&&(t=0);if(n.uniquePlaylist){var r=String("vjs_playlist-"+n.uniquePlaylist);localStorage&&localStorage.getItem(r)&&(t=Number(localStorage.getItem(r)-1))}var i=null,a=!1,l=n.playlist=function(e,t){void 0===t&&(t=0);if(Array.isArray(e)){var r=Array.isArray(i)?i.slice():null,e=e.slice();(i=e.slice()).filter(function(e){return isItemObject(e)}).length!==i.length&&(i=transformPrimitiveItems(i));generatePlaylistItemId(i);a=!1;-1!==t&&l.currentItem(t);r&&n.setTimeout(()=>{n.trigger("playlistchange")},0)}return i.map(function(e){return e.originalValue||e}).slice()};n.on("loadstart",()=>{-1===l.currentItem()&&reset(n)});l.currentIndex_=-1;l.player_=n;l.autoadvance_={};l.repeat_=!1;l.currentPlaylistItemId_=null;l.currentItem=function(e){if(!a){"undefined"===l.currentIndex_&&(l.currentIndex_=0);if("number"===typeof e&&l.currentIndex_!==e&&e>=0&&e<i.length){l.currentIndex_=e;playItem(l.player_,i[l.currentIndex_])}else{e=l.player_.currentSrc()||"";if(l.currentPlaylistItemId_){var t=indexInPlaylistItemIds(i,l.currentPlaylistItemId_),r=i[t];if(r&&Array.isArray(r.sources)&&indexInSources([r],e)>-1)return l.currentIndex_=t,l.currentIndex_;l.currentPlaylistItemId_=null}l.currentIndex_=l.indexOf(e)}}return l.currentIndex_};l.contains=function(e){return-1!==l.indexOf(e)};l.indexOf=function(e){if("string"===typeof e)return indexInSources(i,e);for(var t=Array.isArray(e)?e:e.sources,r=0;r<t.length;r++){var n=t[r];if("string"===typeof n)return indexInSources(i,n);if(n.src)return indexInSources(i,n.src)}return-1};l.remove=function(e){if("number"===typeof e&&e<i.length){n.removeFromPlaylist(e);i.splice(e,1)}};l.insert=function(e){if("undefined"!==typeof e.src||"undefined"!==typeof e.sources){i.push(e);n.addToPlaylist(e)}};l.insertAfter=function(e,t){if((e.src,"number"===typeof t)&&t<=i.length&&t>-1){n.addToPlaylist(e,"after",t);i.splice(t+1,0,e)}};l.insertBefore=function(e,t){if((e.src,"number"===typeof t)&&t<i.length&&t>-1){n.addToPlaylist(e,"before",t);i.splice(t,0,e)}};l.currentIndex=function(){return l.currentItem()};l.lastIndex=function(){return i.length-1};l.nextIndex=function(){var e,t=l.currentItem();return-1===t?-1:(e=l.lastIndex(),l.repeat_&&t===e?0:Math.min(t+1,e))};l.previousIndex=function(){var e=l.currentItem();return-1===e?-1:l.repeat_&&0===e?l.lastIndex():Math.max(e-1,0)};l.first=function(){if(!a){var e=l.currentItem(0);if(i.length)return i[e].originalValue||i[e];l.currentIndex_=-1}};l.last=function(){if(!a){var e=l.currentItem(l.lastIndex());if(i.length)return i[e].originalValue||i[e];l.currentIndex_=-1}};l.next=function(e){var t;return!a&&(t=l.nextIndex())!==l.currentIndex_?(t=l.currentItem(t),i[t].originalValue||i[t]):void 0};l.new=function(e){i=e;n.newPlaylist(i)};l.previous=function(){var e;return!a&&(e=l.previousIndex())!==l.currentIndex_?(e=l.currentItem(e),i[e].originalValue||i[e]):void 0};l.autoadvance=function(e){setup(l.player_,e)};l.repeat=function(e){if(void 0===e)return l.repeat_;if("boolean"===typeof e)return l.repeat_=!!e,l.repeat_};l.list=function(){return i};l.sort=function(e){i.length&&i.sort(e)};Array.isArray(e)?l(e.slice(),t):i=[];return l}var registerPlugin=videojs.registerPlugin||videojs.plugin,plugin=function(e,t){this.ready(function(){factory(this,e,t);this.playlist.autoadvance(0);this.trigger("playlistready")})};registerPlugin("playlist",plugin);export default plugin;
